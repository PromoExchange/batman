<%- api_key = @current_company_store.buyer.spree_api_key unless @current_company_store.nil? %>
<%- api_key = spree_current_user.spree_api_key if api_key.nil? && spree_current_user.present? %>
<%- is_gooten = @current_company_store.slug == 'gooten' %>

<div class="cs-page row" id="new-purchase" data-key="<%= api_key %>">
  <div class="col-md-6">
    <%= large_image(@product, itemprop: 'image', width: '400px', class: 'mobile-image center-block') %><br/>
  </div>

  <div class="col-md-6">
    <h1 id='new_purchase_name'><%= @product.name %></h1>

    <%= form_for @purchase, url: main_app.purchases_path, class: 'form' do |f| %>
      <%= f.hidden_field :company_store_slug, value: @current_company_store.slug %>
      <%= f.hidden_field :product_id, value: @product.id %>
      <%= f.hidden_field :buyer_id, value: @purchase.buyer_id %>

      <% if @purchase.errors.any? %>
        <p class="alert alert-error">Errors</p>
        <ul>
          <% @purchase.errors.full_messages.each do |message| %>
            <li class="error"><%= message %></li>
          <% end %>
        </ul>
      <% end %>

      <fieldset>
        <%= render partial: 'imprint_method', locals: { f: f }%>
        <%= render partial: 'logos', locals: { f: f } %>
        <%= render partial: 'main_color', locals: { f: f } %>
        <% if is_gooten %>
          <%= render partial: 'quantity', locals: { f: f } %>
          <%= render partial: 'address', locals: { f: f } %>
        <% else %>
          <%= render partial: 'price_breaks', locals: { f: f } %>
          <div class="<%= 'col-md-4' unless @product.wearable? %>">
            <%= render partial: 'quantity', locals: { f: f } %>
          </div>
          <div class="<%= 'col-md-8' unless @product.wearable? %>">
            <%= render partial: 'address_drop', locals: { f: f } %>
          </div>
        <% end %>
        <p id='mobile-align-center'>Estimated delivery date: <%= content_tag(:span, '--', id: 'ship_date') %></p>
        <%= render partial: 'shipping_options', locals: { f: f } %>
        <%= render partial: 'active_price', locals: { f: f } %>
        <%= render partial: 'buttons', locals: { f: f } %>
      </fieldset>
    <% end %>

    <% if @product.description %>
      <p id='mobile-align-center'><strong>Description:</strong> <%= @product.description %></p>
    <% end %>

    <p id='mobile-align-center'><strong>Factory:</strong> <%= @product.original_supplier.name %></p>
    <p id='mobile-align-center'><strong>SKU:</strong> <%= @product.sku %></p>
  </div>
</div>
