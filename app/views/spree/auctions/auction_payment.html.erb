<% content_for :head do %>
<script type="text/javascript" src="https://js.stripe.com/v2/"></script>
<script type="text/javascript">
  Stripe.setPublishableKey('<%= ENV["STRIPE_PUBLISHABLE_KEY"] %>');
</script>
<% end %>


<div class="row" id="show-invoice" data-key="<%= spree_current_user.spree_api_key %>">
  <% if spree_current_user.has_spree_role?(:buyer) %>
    <div class="col-md-6 well">
      <% if (@auction.open? or @auction.waiting?) and ( @bid.open? or @bid.lost?) %>
        <div class="form-group error">
          <ul></ul>
        </div>
        <div class="form-group">
          <%= label_tag(:payment_method, "Payment Method") %>
          <ul class="list-group customer-listing">
            <% @customers.each do |customer| %>
              <li class='list-group-item customer-listing'>
                <%= radio_button_tag('auction[customer_id]', customer.id) %> <%= label_tag("#{customer.brand}##{customer.last_4_digits}")%>
              </li>
            <% end %>
          </ul>
        </div>
        <p><%= link_to "Add Payment Method", "/dashboards?tab=payment_method", target: '_blank' %></p>
        <div class="form-group">
          <%= label_tag(:shipping_address_id, 'Shipping Address') %>
          <%= select_tag(:shipping_address_id, options_for_select(@addresses, @auction.shipping_address_id),
             { prompt: 'Please Select' ,  class: 'form-control' }) %>
        </div>
        <p><a href="#" id="add-address-link" data-toggle="modal" data-target="#auction-add-address">Add Address</a></p>
        <div class="form-group">
          <%= button 'Submit', 'ok', 'submit', { class: 'btn-success', id: 'accept-bid', data: {bid: @bid.id} } %>
        </div>
      <% end %>

      <% if @bid.accepted? and @auction.waiting_confirmation? %>
        <div class="form-group">
          <p>Thanks for your order! We will be processing your payment and <%= @bid.seller.shipping_address.full_name %> will be confirming and processing your order shortly. </p>
        </div>
        <div class="form-group text-center">
          <%= link_to 'Dashboard', '/dashboards?tab=purchase_history', class: 'btn btn-success' %>
        </div>
      <% end %>
    </div>
  <% end %>

  <div class="col-md-6">
    <% url = spree.product_url(@auction.product) %>
    <div>
      <div class="col-md-3"><%= link_to small_image(@auction.product, itemprop: "image"), url, itemprop: 'url' %></div>
      <div class="col-md-9"><br><%= @auction.product.description %></div>
    </div>
    <table id="auction-product-properties" class="table table-striped">
      <tbody>
        <tr><td><strong>Color:</strong></td><td><%= @auction.main_color.color %></td></tr>
        <tr><td><strong>QTY:</strong></td><td><%= render partial: 'spree/shared/auction_size_detail', locals: {auction: @auction} %></td></tr>
        <tr><td><strong>Payment Method:</strong></td><td><%= @auction.payment_method %></td></tr>
        <tr><td><strong>Total Amount:</strong></td><td><%= @bid.bid %></td></tr>
      </tbody>
    </table>
  </div>
</div>

 <%= render partial: 'spree/auctions/address_modal' %>
